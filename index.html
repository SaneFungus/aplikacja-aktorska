<!DOCTYPE html>
<html lang="pl" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Embodied Actor - Projekt Interfejsu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" xintegrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 5px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        /* Simple transition for screen changes */
        .screen {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        .screen.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 h-full flex items-center justify-center p-2">

    <div class="w-full max-w-sm h-[800px] max-h-[90vh] bg-gray-800 rounded-3xl shadow-2xl overflow-hidden flex flex-col relative border-4 border-gray-700">
        
        <!-- App Header -->
        <header class="bg-gray-900/50 backdrop-blur-sm p-4 text-center z-10">
            <h1 id="header-title" class="text-xl font-bold text-white">Kokpit</h1>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-y-auto p-6 space-y-6">
            
            <!-- Kokpit / Home Screen -->
            <div id="screen-home" class="screen active space-y-6">
                <h2 class="text-2xl font-semibold text-white">Witaj w Studio!</h2>
                <p class="text-gray-400">Twoja przestrzeń do eksploracji emocji, ciała i rzemiosła aktorskiego.</p>

                <div class="bg-gray-700/50 p-5 rounded-xl">
                    <h3 class="font-bold text-lg mb-2 text-indigo-400"><i class="fa-solid fa-star-of-life mr-2"></i>Ćwiczenie na dziś</h3>
                    <div id="daily-exercise">
                        <p class="text-gray-400">Ładowanie propozycji...</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 gap-4">
                     <button onclick="navigateTo('thesaurus')" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 px-5 rounded-lg text-left transition-transform transform hover:scale-105">
                        <i class="fa-solid fa-book-open w-6 mr-2"></i>Słownik Emocji
                        <p class="text-sm font-normal text-indigo-200 mt-1">Przeglądaj i analizuj setki sygnałów.</p>
                    </button>
                    <button onclick="navigateTo('improvisation')" class="bg-teal-600 hover:bg-teal-500 text-white font-bold py-4 px-5 rounded-lg text-left transition-transform transform hover:scale-105">
                         <i class="fa-solid fa-masks-theater w-6 mr-2"></i>Generator Improwizacji
                         <p class="text-sm font-normal text-teal-200 mt-1">Otrzymuj losowe scenariusze i emocje.</p>
                    </button>
                    <button onclick="navigateTo('physical')" class="bg-rose-600 hover:bg-rose-500 text-white font-bold py-4 px-5 rounded-lg text-left transition-transform transform hover:scale-105">
                        <i class="fa-solid fa-person-running w-6 mr-2"></i>Laboratorium Fizyczne
                        <p class="text-sm font-normal text-rose-200 mt-1">Łącz ruch z abstrakcyjnymi emocjami.</p>
                    </button>
                </div>
            </div>

            <!-- Słownik Emocji Screen -->
            <div id="screen-thesaurus" class="screen space-y-4">
                 <div class="relative">
                    <input type="text" id="emotion-search" placeholder="Szukaj emocji..." class="w-full bg-gray-700 border border-gray-600 rounded-lg py-2 px-4 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <i class="fa-solid fa-search absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                </div>
                <div id="emotion-list" class="space-y-3">
                    <!-- Emotion items will be loaded here -->
                </div>
            </div>
             <!-- Detail view for a single emotion -->
            <div id="screen-thesaurus-detail" class="screen space-y-4">
                <!-- Content will be loaded here -->
            </div>


            <!-- Generator Improwizacji Screen -->
            <div id="screen-improvisation" class="screen flex flex-col items-center justify-center h-full text-center space-y-6">
                <div id="impro-card" class="bg-gray-700/80 p-6 rounded-2xl w-full shadow-lg">
                    <h3 id="impro-title" class="text-xl font-bold text-teal-400 mb-2"></h3>
                    <p id="impro-scenario" class="text-gray-300 mb-4"></p>
                    <div id="impro-emotions" class="space-y-2 text-left bg-gray-800 p-4 rounded-lg">
                        <!-- Emotion assignments will appear here -->
                    </div>
                </div>
                <button id="generate-impro" class="w-full bg-teal-600 hover:bg-teal-500 text-white font-bold py-3 px-6 rounded-xl text-lg transition-transform transform hover:scale-105">
                    <i class="fa-solid fa-dice-d6 mr-2"></i>Losuj nowe ćwiczenie
                </button>
            </div>

            <!-- Laboratorium Fizyczne Screen -->
            <div id="screen-physical" class="screen flex flex-col items-center justify-center h-full text-center space-y-6">
                <div class="w-full space-y-5">
                    <div class="bg-gray-700/80 p-6 rounded-2xl shadow-lg">
                        <h3 class="text-sm font-bold uppercase text-rose-400 mb-2">Zadanie fizyczne</h3>
                        <p id="physical-task" class="text-lg text-gray-200"></p>
                    </div>
                    <div class="text-2xl font-bold text-gray-500">+</div>
                     <div class="bg-gray-700/80 p-6 rounded-2xl shadow-lg">
                        <h3 class="text-sm font-bold uppercase text-indigo-400 mb-2">Emocja do odkrycia</h3>
                        <p id="physical-emotion" class="text-2xl font-bold text-white"></p>
                    </div>
                </div>
                 <button id="generate-physical" class="w-full bg-rose-600 hover:bg-rose-500 text-white font-bold py-3 px-6 rounded-xl text-lg transition-transform transform hover:scale-105">
                    <i class="fa-solid fa-flask-vial mr-2"></i>Generuj nowy koktajl
                </button>
            </div>

        </main>

        <!-- Bottom Navigation -->
        <nav class="bg-gray-900/50 backdrop-blur-sm mt-auto flex justify-around p-1">
            <button onclick="navigateTo('home')" id="nav-home" class="nav-btn flex-1 text-indigo-400 p-3 rounded-xl">
                <i class="fa-solid fa-house text-xl"></i>
                <span class="text-xs block">Kokpit</span>
            </button>
            <button onclick="navigateTo('thesaurus')" id="nav-thesaurus" class="nav-btn flex-1 text-gray-400 p-3 rounded-xl">
                <i class="fa-solid fa-book-open text-xl"></i>
                 <span class="text-xs block">Słownik</span>
            </button>
            <button onclick="navigateTo('improvisation')" id="nav-improvisation" class="nav-btn flex-1 text-gray-400 p-3 rounded-xl">
                 <i class="fa-solid fa-masks-theater text-xl"></i>
                 <span class="text-xs block">Impro</span>
            </button>
            <button onclick="navigateTo('physical')" id="nav-physical" class="nav-btn flex-1 text-gray-400 p-3 rounded-xl">
                <i class="fa-solid fa-person-running text-xl"></i>
                 <span class="text-xs block">Laboratorium</span>
            </button>
        </nav>
    </div>

    <script>
        const screens = document.querySelectorAll('.screen');
        const navButtons = document.querySelectorAll('.nav-btn');
        const headerTitle = document.getElementById('header-title');
        let database = {};

        const screenTitles = {
            'home': 'Kokpit',
            'thesaurus': 'Słownik Emocji',
            'thesaurus-detail': 'Szczegóły Emocji',
            'improvisation': 'Generator Improwizacji',
            'physical': 'Laboratorium Fizyczne'
        };

        // --- DATA LOADING ---
        async function loadDatabase() {
            try {
                const response = await fetch('./database.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                database = await response.json();
                initializeApp();
            } catch (e) {
                console.error("Nie udało się załadować bazy danych. Upewnij się, że plik 'database.json' istnieje i jest poprawny.", e);
                document.getElementById('daily-exercise').innerHTML = '<p class="text-red-400">Błąd ładowania danych.</p>';
            }
        }
        
        function getRandomItem(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        // --- INITIALIZATION ---
        function initializeApp() {
            populateEmotionList();
            setupDailyExercise();
            setupImprovisationGenerator();
            setupPhysicalLabGenerator();
            setupEmotionSearch();
        }
        
        function setupDailyExercise() {
            const dailyExerciseContainer = document.getElementById('daily-exercise');
            const exerciseTypes = ['impro', 'physical'];
            const randomType = getRandomItem(exerciseTypes);

            let exercise, button;

            if (randomType === 'impro' && database.improvisationExercises) {
                exercise = getRandomItem(database.improvisationExercises);
                dailyExerciseContainer.innerHTML = `<p class="font-semibold">${exercise.title}</p><p class="text-sm text-gray-400">${exercise.scenario.substring(0, 70)}...</p>`;
                button = document.createElement('button');
                button.className = 'mt-3 bg-teal-600/50 text-teal-200 text-sm font-bold py-1 px-3 rounded-md hover:bg-teal-600';
                button.textContent = 'Przejdź do ćwiczenia';
                button.onclick = () => navigateTo('improvisation', exercise.id);
                dailyExerciseContainer.appendChild(button);

            } else if (randomType === 'physical' && database.physicalExercises) {
                exercise = getRandomItem(database.physicalExercises);
                dailyExerciseContainer.innerHTML = `<p class="font-semibold">${exercise.title}</p><p class="text-sm text-gray-400">${exercise.description.substring(0, 70)}...</p>`;
                button = document.createElement('button');
                button.className = 'mt-3 bg-rose-600/50 text-rose-200 text-sm font-bold py-1 px-3 rounded-md hover:bg-rose-600';
                button.textContent = 'Przejdź do ćwiczenia';
                button.onclick = () => navigateTo('physical', exercise.id);
                dailyExerciseContainer.appendChild(button);
            }
        }

        // --- NAVIGATION ---
        function navigateTo(screenId, data) {
            screens.forEach(s => s.classList.remove('active'));
            
            const targetScreen = document.getElementById(`screen-${screenId}`);
            if (targetScreen) {
                targetScreen.classList.add('active');
            }
            
            headerTitle.textContent = screenTitles[screenId] || 'Embodied Actor';

            navButtons.forEach(btn => {
                if (btn.id.includes(screenId.split('-')[0])) {
                    btn.classList.remove('text-gray-400');
                    btn.classList.add('text-indigo-400', 'bg-gray-700');
                } else {
                    btn.classList.add('text-gray-400');
                    btn.classList.remove('text-indigo-400', 'bg-gray-700');
                }
            });

            // Handle specific screen logic
            if (screenId === 'improvisation' && data) {
                generateImprovisation(data);
            }
             if (screenId === 'physical' && data) {
                generatePhysicalCocktail(data);
            }
        }

        // --- THESAURUS MODULE ---
        function populateEmotionList() {
            const list = document.getElementById('emotion-list');
            if (!list || !database.emotionsDatabase) return;
            list.innerHTML = '';
            database.emotionsDatabase.forEach(emotion => {
                const item = document.createElement('div');
                item.className = 'bg-gray-700 p-4 rounded-lg cursor-pointer hover:bg-gray-600';
                item.innerHTML = `
                    <h3 class="font-bold text-lg text-white">${emotion.name}</h3>
                    <p class="text-sm text-gray-400">${emotion.definition}</p>
                `;
                item.onclick = () => showEmotionDetail(emotion.name);
                list.appendChild(item);
            });
        }
        
        function showEmotionDetail(emotionName) {
            const emotion = database.emotionsDatabase.find(e => e.name === emotionName);
            if (!emotion) return;

            const detailContainer = document.getElementById('screen-thesaurus-detail');
            
            const createSection = (title, items) => {
                if (!items || items.length === 0) return '';
                return `
                    <details class="bg-gray-700 rounded-lg overflow-hidden">
                        <summary class="font-semibold p-3 cursor-pointer hover:bg-gray-600">${title}</summary>
                        <ul class="list-disc list-inside bg-gray-800 p-4 pl-8 text-gray-300">
                            ${items.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </details>
                `;
            };

            detailContainer.innerHTML = `
                <button onclick="navigateTo('thesaurus')" class="text-indigo-400 font-semibold mb-4"><i class="fa-solid fa-arrow-left mr-2"></i>Wróć do listy</button>
                <h2 class="text-3xl font-bold text-white">${emotion.name}</h2>
                <p class="text-gray-400 pb-4">${emotion.definition}</p>
                <div class="space-y-2">
                    ${createSection('Sygnały fizyczne', emotion.physicalSignals)}
                    ${createSection('Doznania wewnętrzne', emotion.internalSensations)}
                    ${createSection('Reakcje mentalne', emotion.mentalResponses)}
                    ${createSection('Sygnały w ostrej fazie', emotion.cuesAcute)}
                    ${createSection('Sygnały długoterminowe', emotion.cuesLongTerm)}
                    ${createSection('Propozycje ćwiczeń aktorskich', emotion.actorPrompts)}
                </div>
            `;
            navigateTo('thesaurus-detail');
        }

        function setupEmotionSearch() {
            const searchInput = document.getElementById('emotion-search');
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const allEmotions = document.querySelectorAll('#emotion-list > div');
                allEmotions.forEach(emotionEl => {
                    if (emotionEl.textContent.toLowerCase().includes(searchTerm)) {
                        emotionEl.style.display = 'block';
                    } else {
                        emotionEl.style.display = 'none';
                    }
                });
            });
        }

        // --- IMPROVISATION MODULE ---
        function setupImprovisationGenerator() {
            const generateBtn = document.getElementById('generate-impro');
            generateBtn.addEventListener('click', () => generateImprovisation());
            generateImprovisation();
        }

        function generateImprovisation(exerciseId) {
            let exercise;
            if (exerciseId) {
                exercise = database.improvisationExercises.find(e => e.id === exerciseId);
            } else {
                exercise = getRandomItem(database.improvisationExercises);
            }

            if (!exercise) return;

            document.getElementById('impro-title').textContent = exercise.title;
            document.getElementById('impro-scenario').textContent = exercise.scenario;
            
            const emotionsContainer = document.getElementById('impro-emotions');
            emotionsContainer.innerHTML = '';

            const numParticipants = parseInt(exercise.participants) || 2; // Default to 2
            for (let i = 0; i < numParticipants; i++) {
                const randomEmotion = getRandomItem(database.emotionsDatabase);
                const charLabel = String.fromCharCode(65 + i); // A, B, C...
                const emotionLine = document.createElement('p');
                emotionLine.className = 'text-gray-300';
                emotionLine.innerHTML = `<strong>Postać ${charLabel}:</strong> <span class="font-semibold text-white">${randomEmotion.name}</span>`;
                emotionsContainer.appendChild(emotionLine);
            }
        }
        
        // --- PHYSICAL LAB MODULE ---
        function setupPhysicalLabGenerator() {
             const generateBtn = document.getElementById('generate-physical');
            generateBtn.addEventListener('click', () => generatePhysicalCocktail());
            generatePhysicalCocktail();
        }

        function generatePhysicalCocktail(exerciseId) {
            let physicalTask;
            if (exerciseId) {
                physicalTask = database.physicalExercises.find(e => e.id === exerciseId);
            } else {
                physicalTask = getRandomItem(database.physicalExercises);
            }

            const randomEmotion = getRandomItem(database.emotionsDatabase);

            if (!physicalTask || !randomEmotion) return;

            document.getElementById('physical-task').textContent = physicalTask.description;
            document.getElementById('physical-emotion').textContent = randomEmotion.name;
        }

        // --- Start the app ---
        document.addEventListener('DOMContentLoaded', loadDatabase);

    </script>
</body>
</html>
